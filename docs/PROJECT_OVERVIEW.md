# 🛒 Северная Корзина - Обзор проекта

## 📋 Общее описание

**Северная Корзина** - это платформа коллективных закупок для жителей Усть-Неры, Якутия. Проект позволяет пользователям объединяться для совместных закупок товаров, что снижает стоимость доставки и позволяет получать товары по более выгодным ценам.

---

## 🎯 Основная идея

Жители отдалённых районов Якутии сталкиваются с:
- Высокими ценами на товары
- Дорогой доставкой
- Ограниченным ассортиментом

**Решение**: Платформа для объединения заказов в партии, что позволяет:
- ✅ Снизить стоимость доставки на человека
- ✅ Получить доступ к широкому ассортименту
- ✅ Гарантировать качество и подлинность товаров
- ✅ Отслеживать статус заказа на каждом этапе

---

## 🏗️ Архитектура проекта

### Технологический стек

```
┌─────────────────────────────────────────────┐
│          Мобильное приложение               │
│         Flutter (Android/iOS/Web)            │
│              Версия: 1.2.0                   │
└──────────────────┬──────────────────────────┘
                   │ REST API
                   │ JWT Auth
┌──────────────────┴──────────────────────────┐
│              Backend API                     │
│        Node.js + Express + Prisma            │
│            Версия: 1.0.0                     │
└──────────────────┬──────────────────────────┘
                   │
         ┌─────────┴─────────┐
         │                   │
┌────────┴────────┐  ┌───────┴────────┐
│   PostgreSQL    │  │   Интеграции   │
│  (Yandex Cloud) │  │                │
│   10 таблиц     │  │ • Точка Банк   │
└─────────────────┘  │ • SMS Aero     │
                     └────────────────┘
```

### Репозитории

1. **Backend**: `severnaya-korzina-backend`
   - Node.js, Express.js, Prisma ORM
   - REST API с JWT авторизацией
   - Интеграция с Точка Банк и SMS Aero

2. **Mobile/Web**: `severnaya_korzina`
   - Flutter для iOS, Android и Web
   - Единая кодовая база для всех платформ
   - PWA поддержка для iOS

3. **Admin Panel**: `severnaya_korzina_admin`
   - Flutter Web приложение
   - Управление товарами, заказами, партиями
   - Аналитика и отчёты

---

## 👥 Пользовательские роли

### 1. Покупатель
- Просмотр каталога товаров
- Оформление заказов
- Отслеживание статуса
- Оплата через Точка Банк
- Управление адресами доставки

### 2. Администратор
- Управление товарами и категориями
- Создание и управление партиями
- Просмотр и обработка заказов
- Формирование общего заказа для поставщика
- Отправка SMS уведомлений
- Системные настройки

---

## 🔄 Бизнес-процесс

### Жизненный цикл партии

```
1. СОЗДАНИЕ
   ↓
   Админ создаёт новую партию с целевой суммой
   
2. СБОР ЗАКАЗОВ
   ↓
   Пользователи добавляют товары и оформляют заказы
   Платёж через Точка Банк → статус "Оплачен"
   
3. ДОСТИЖЕНИЕ ЦЕЛИ
   ↓
   Партия достигает 100% от целевой суммы
   Статус автоматически меняется на "Готова к запуску"
   
4. ЗАПУСК ПАРТИИ
   ↓
   Админ формирует общий заказ у поставщика
   Статус: "Запущена" → SMS уведомления пользователям
   
5. ОТПРАВКА
   ↓
   Товары отправлены транспортной компанией
   Статус заказов: "Отправлен"
   
6. ДОСТАВКА
   ↓
   Товары прибыли в Усть-Неру
   Пользователи получают SMS с адресом выдачи
   Статус: "Доставлен"
```

---

## 💳 Платёжная система

### Интеграция с Точка Банк (с 30.09.2025)

**Возможности:**
- ✅ Создание платежей через API
- ✅ Поддержка СБП и банковских карт
- ✅ Автоматическая фискализация чеков
- ✅ Webhook для мгновенного обновления статусов
- ✅ Разделение на товары и услугу доставки
- ✅ Автоматический расчёт НДС

**Процесс оплаты:**
1. Пользователь оформляет заказ
2. Система создаёт платёж в Точка Банк
3. Пользователь переходит на платёжную страницу
4. Оплачивает через СБП или карту
5. Webhook моментально обновляет статус заказа
6. Обновляется прогресс партии

---

## 📊 База данных

### Структура (10 таблиц)

```sql
users                 -- Пользователи
├─ addresses          -- Адреса доставки
├─ orders             -- Заказы
│  ├─ order_items     -- Позиции заказа
│  └─ payments        -- Платежи (новая таблица 30.09.2025)
│
categories            -- Категории товаров
└─ products           -- Товары
   
batches               -- Партии закупок
└─ batch_items        -- Товары в партии

system_settings       -- Системные настройки
```

### Ключевые связи
- `payments` → `orders` (CASCADE при удалении)
- `orders` → `users` (RESTRICT - нельзя удалить пользователя с заказами)
- `orders` → `batches` (SET NULL при удалении партии)
- `order_items` → `products` (RESTRICT)

---

## 🚀 Развёртывание

### Production окружение

**Сервер**: Yandex Cloud
- IP: 84.201.149.245
- OS: Ubuntu 22.04
- Process Manager: PM2
- Reverse Proxy: Nginx

**Домены**:
- Backend API: `http://84.201.149.245:3000`
- Web App: `http://app.sevkorzina.ru`
- Webhook: `https://app.sevkorzina.ru/api/payments/webhook`

**База данных**: Yandex Managed PostgreSQL
- Version: 15
- Размер: ~110 MB
- Резервное копирование: ежедневно

---

## 📱 Мобильные приложения

### Android
- **Формат**: APK (native)
- **Размер**: ~35 MB
- **Версия**: 1.2.0+12
- **Min SDK**: 21 (Android 5.0)
- **Установка**: Прямая загрузка APK

### iOS / Web
- **Формат**: PWA (Progressive Web App)
- **Поддержка**: iOS Safari, все современные браузеры
- **Установка**: "Добавить на домашний экран"
- **Функции**: Работа офлайн, push уведомления

### Desktop (Admin)
- **Платформы**: macOS, Windows, Linux
- **Технология**: Flutter Desktop
- **Статус**: В разработке

---

## 🔐 Безопасность

### Аутентификация
- JWT токены с истечением (24 часа)
- SMS-код для входа (через SMS Aero)
- Refresh tokens для продления сессии

### Защита API
- Rate limiting (100 запросов/15 минут)
- Helmet.js для защиты заголовков
- CORS политики
- Валидация всех входных данных (Joi)
- Prisma ORM (защита от SQL-инъекций)

### Платежи
- HTTPS для всех транзакций
- Безопасное хранение токенов в `.env`
- Webhook signature verification
- PCI DSS compliance (через Точка Банк)

---

## 📈 Метрики проекта (на старте)

### Планируемые показатели
- 👥 **Начальная база**: 50-100 пользователей
- 📦 **Первая партия**: В тестировании
- 🛒 **Целевой чек**: ~2,500₽
- 💰 **Плановый оборот**: ~250,000₽/месяц
- ⏱️ **Целевой Uptime**: 99.9%
- 🚀 **API Response Time**: <100ms

---

## 🎯 Функциональность

### Реализовано ✅

**Для пользователей:**
- SMS авторизация
- Каталог с поиском и фильтрацией
- Корзина с swipe-to-delete
- Оформление заказов
- Оплата через Точка Банк (СБП, карты)
- История заказов с трекингом
- Управление адресами
- Принятие пользовательского соглашения
- OTA обновления приложения

**Для администраторов:**
- Dashboard с аналитикой
- Управление товарами и категориями
- Создание и управление партиями
- Просмотр и обработка заказов
- Формирование общего заказа
- SMS рассылки
- Системные настройки (НДС, маржа)
- Режим обслуживания

### В разработке 🔄

**Высокий приоритет:**
- Cron задачи для проверки платежей
- Автоотмена просроченных заказов
- API возврата средств

**Средний приоритет:**
- История платежей для пользователей
- Админ-панель управления платежами
- Push уведомления

**Низкий приоритет:**
- Портал для поставщиков
- Программа лояльности
- Интеграция с 1С

---

## 🛠️ Системные требования

### Для разработки

**Backend:**
- Node.js 18+
- PostgreSQL 15+
- npm 9+

**Mobile/Web:**
- Flutter SDK 3.8.1+
- Dart 3.8.1+
- Android Studio (для Android)
- Xcode (для iOS/macOS)

### Для продакшена

**Минимальные:**
- CPU: 2 cores
- RAM: 2GB
- Disk: 20GB
- Network: 100 Mbps

**Рекомендуемые:**
- CPU: 4 cores
- RAM: 4GB
- Disk: 50GB SSD
- Network: 1 Gbps 

---

## 📞 Контакты и поддержка

### Техническая поддержка
- **Email**: sevkorzina@gmail.com
- **Телефон**: +7 (914) 266-75-82
- **GitHub**: https://github.com/idob23/

### Документация
- Обзор проекта: `/docs/PROJECT_OVERVIEW.md`
- Текущий статус: `/docs/CURRENT_STATUS.md`
- Структура проекта: `/docs/PROJECT_STRUCTURE.md`
- API документация: В разработке

---

## 🗓️ История версий

### v1.2.0 (30.09.2025) - Текущая
- ✨ Интеграция с Точка Банк
- ✨ Таблица payments в БД
- ✨ Фискализация чеков
- ✨ Webhook для платежей
- 🐛 Исправления багов в расчёте прогресса партий

### v1.1.0 (15.08.2025)
- ✨ Режим обслуживания
- ✨ Системные настройки
- ✨ SMS рассылки
- 🔧 Оптимизация производительности

### v1.0.0 (26.07.2025) - MVP
- 🎉 Создание начальной версии
- ✅ Базовая функциональность
- ✅ Структура БД и API

---

## 📝 Лицензия и правовая информация

**Статус проекта**: Pre-Production (в разработке)  
**Дата начала**: 01.07.2025  
**Время разработки**: 3 месяца  
**Прогноз запуска**: 15-20 октября 2025

### Документы
- Пользовательское соглашение: `/public/agreement.html`
- Политика конфиденциальности: `/public/privacy.html`
- Договор-оферта: `/public/offer.html`

---

> 📌 **Документ обновлён**: 01.10.2025  
> 📌 **Версия документа**: 2.0  
> 📌 **Статус проекта**: PRE-PRODUCTION (85% готовности)