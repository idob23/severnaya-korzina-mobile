# Северная Корзина - Полное описание проекта

## 🏗️ Архитектура системы

### Общая схема
```
┌─────────────────┐    ┌──────────────────┐    ┌─────────────────┐
│   Flutter App   │───▶│   Backend API    │───▶│   PostgreSQL    │
│  (Mobile/Web)   │    │ (Node.js/Express)│    │   (Database)    │
└─────────────────┘    └──────────────────┘    └─────────────────┘
         │                       │
         │              ┌────────▼────────┐
         │              │    ЮKassa API   │
         │              │   (Payments)    │
         │              └─────────────────┘
         │
┌────────▼────────┐
│   Admin Panel   │
│   (Flutter)     │
└─────────────────┘
```

## 🌐 Инфраструктура и домены

### Основные URL:
- **Главный сайт**: https://sevkorzina.ru/
  - Лендинг страница
  - Скачивание Android APK
  - Информация о проекте

- **Веб-приложение**: https://app.sevkorzina.ru/ 
  - **БЕЗ SSL сертификата** (намеренно для SMS рассылки)
  - Flutter Web версия приложения
  - Полная функциональность мобильного приложения

- **API сервер**: Yandex Cloud
  - Настроен с sudo правами
  - Node.js + Express + Prisma
  - PostgreSQL база данных
  - Интеграция с ЮKassa

### Серверная инфраструктура:
- **Хостинг**: Yandex Cloud
- **Операционная система**: Linux (sudo доступ)
- **База данных**: PostgreSQL
- **Файлы сервера**: Актуальные версии в project knowledge
- **Мониторинг**: Логи сервера обновляются в project files

## 📱 Мобильное приложение (Flutter)

### Структура проекта:
```
lib/
├── main.dart                 # Точка входа приложения
├── models/                   # Модели данных
│   ├── user.dart            # Модель пользователя
│   ├── product.dart         # Модель товара
│   ├── order.dart           # Модель заказа
│   └── cart_item.dart       # Элемент корзины
├── providers/               # State Management (Provider)
│   ├── auth_provider.dart   # Авторизация и аутентификация
│   ├── cart_provider.dart   # Управление корзиной
│   ├── orders_provider.dart # Управление заказами
│   └── products_provider.dart # Каталог товаров
├── services/                # Сервисы
│   ├── api_service.dart     # Основной API клиент
│   ├── notification_service.dart # Push уведомления
│   └── admin_api_service.dart # API для админки
├── screens/                 # Экраны приложения
│   ├── home/
│   │   └── home_screen.dart # Главный экран с навигацией
│   ├── auth/
│   │   ├── auth_choice_screen.dart # Выбор входа/регистрации
│   │   ├── login_screen.dart       # Экран входа
│   │   └── register_screen.dart    # Экран регистрации
│   ├── catalog/
│   │   └── catalog_screen.dart # Каталог товаров
│   ├── cart/
│   │   └── cart_screen.dart   # Корзина
│   ├── checkout/
│   │   └── checkout_screen.dart # Оформление заказа
│   ├── payment/
│   │   ├── payment_screen.dart     # Процесс оплаты
│   │   ├── payment_service.dart    # Сервис платежей
│   │   └── payment_success_screen.dart # Успешная оплата
│   ├── orders/
│   │   ├── orders_screen.dart      # Список заказов
│   │   └── order_details_screen.dart # Детали заказа
│   └── profile/
│       └── profile_screen.dart # Профиль пользователя
└── utils/                   # Утилиты и хелперы
```

### Ключевые провайдеры (State Management):
- **AuthProvider**: Авторизация, JWT токены, состояние пользователя
- **CartProvider**: Управление корзиной, расчет сумм
- **OrdersProvider**: Заказы, создание, обновление статусов
- **ProductsProvider**: Каталог, категории, поиск товаров

### Основной пользовательский путь:
1. **Авторизация** → AuthChoiceScreen → LoginScreen/RegisterScreen
2. **Каталог** → CatalogScreen → добавление в корзину
3. **Корзина** → CartScreen → управление товарами
4. **Оформление** → CheckoutScreen → выбор адреса/времени
5. **Оплата** → PaymentScreen → интеграция с ЮKassa
6. **Успех** → PaymentSuccessScreen → переход к заказам
7. **Заказы** → OrdersScreen → отслеживание статуса

## 🖥️ Панель администратора (Flutter Desktop/Web)

### Структура админки:
```
lib/
├── main.dart                # Точка входа админки
├── screens/
│   ├── dashboard_screen.dart    # Главная страница с метриками
│   ├── users_management.dart    # Управление пользователями
│   ├── orders_management.dart   # Управление заказами
│   ├── products_management.dart # Управление товарами
│   ├── batches_management.dart  # Управление партиями закупок
│   ├── money_collection.dart    # Сбор денег с пользователей
│   └── settings_screen.dart     # Настройки системы
└── services/
    └── admin_api_service.dart   # API для админских операций
```

### Функциональность админки:
- **Dashboard**: Статистика заказов, выручка, активные пользователи
- **Пользователи**: Просмотр, редактирование, блокировка
- **Заказы**: Изменение статусов, обработка, отчеты
- **Товары**: CRUD операции, управление категориями
- **Партии**: Создание закупок, распределение товаров
- **Сбор денег**: Отслеживание платежей, формирование счетов

## 🔧 Backend API (Node.js + Express)

### Структура сервера:
```
src/
├── server.js                # Основной файл сервера
├── routes/                  # API маршруты
│   ├── auth.js             # Авторизация (/api/auth/*)
│   ├── users.js            # Пользователи (/api/users/*)
│   ├── products.js         # Товары (/api/products/*)
│   ├── orders.js           # Заказы (/api/orders/*)
│   ├── payments.js         # Платежи (/api/payments/*)
│   └── admin.js            # Админские операции
├── middleware/             # Промежуточное ПО
│   ├── auth.js            # JWT верификация
│   └── admin.js           # Проверка админских прав
├── prisma/                # ORM и схема БД
│   ├── schema.prisma      # Схема базы данных
│   └── migrations/        # Миграции БД
└── utils/                 # Утилиты
    └── yookassa.js        # Интеграция с ЮKassa
```

### Основные API эндпоинты:

#### Авторизация:
- `POST /api/auth/register` - Регистрация
- `POST /api/auth/login` - Вход
- `GET /api/auth/profile` - Профиль пользователя
- `POST /api/auth/admin-login` - Вход админа

#### Товары:
- `GET /api/products` - Список товаров
- `GET /api/products/:id` - Детали товара
- `GET /api/categories` - Категории

#### Заказы:
- `GET /api/orders` - Заказы пользователя
- `POST /api/orders` - Создание заказа
- `GET /api/orders/:id` - Детали заказа

#### Платежи:
- `POST /api/payments/create` - Создание платежа
- `GET /api/payments/:id/status` - Статус платежа
- `POST /api/payments/webhook` - Webhook от ЮKassa

#### Админка:
- `GET /api/admin/dashboard/stats` - Статистика
- `GET /api/admin/users` - Управление пользователями
- `GET /api/admin/orders` - Управление заказами
- `POST /api/admin/products` - Создание товаров

### База данных (PostgreSQL):
```sql
-- Основные таблицы:
users           # Пользователи
products        # Товары
categories      # Категории товаров
orders          # Заказы
order_items     # Позиции заказов
addresses       # Адреса доставки
batches         # Партии закупок
payments        # Платежи
```

## 💳 Интеграция с платежами (ЮKassa)

### Процесс оплаты:
1. **Создание платежа** - PaymentService → Backend → ЮKassa API
2. **Редирект** - Пользователь → ЮKassa форма оплаты
3. **Webhook** - ЮKassa → Backend (автоматическое создание заказа)
4. **Подтверждение** - Backend → Frontend (уведомление об успехе)

### Настройки ЮKassa:
- **Тестовый режим**: Включен для разработки
- **Webhook URL**: Настроен на сервер
- **Методы оплаты**: Банковские карты (МИР, Visa, MasterCard)

## 🌐 Веб-сайт (Лендинг)

### Структура главной страницы:
```
public/
├── index.html              # Главная страница
├── css/
│   └── styles.css         # Стили сайта
├── js/
│   └── main.js           # JavaScript функциональность
├── images/               # Изображения и иконки
└── downloads/
    └── app.apk          # Android приложение для скачивания
```

### Функциональность лендинга:
- **Описание проекта** - Что такое коллективные закупки
- **Скачивание приложения** - Прямая ссылка на APK
- **Контакты** - Информация для связи
- **Переход на веб-версию** - Ссылка на app.sevkorzina.ru

## 🔄 Текущий статус разработки

### ✅ Реализовано:
- **Базовая архитектура** - Все компоненты работают
- **Авторизация** - Полная система регистрации/входа
- **Каталог товаров** - Просмотр, поиск, добавление в корзину
- **Корзина** - Управление товарами, расчет сумм
- **Оформление заказов** - CheckoutScreen с выбором параметров
- **Платежи** - Интеграция с ЮKassa
- **Заказы** - Создание и просмотр
- **Админка** - Базовое управление системой
- **Деплой** - Все компоненты развернуты на Yandex Cloud

### 🔄 В разработке:
- **Переход на заказы после оплаты** - Автоматическое обновление UI
- **Push уведомления** - Уведомления о статусе заказов
- **Улучшение UX** - Оптимизация пользовательского опыта

### 📝 Планируется:
- **Управление адресами** - Множественные адреса доставки
- **Избранные товары** - Wishlist функциональность
- **Повторные заказы** - Быстрое переоформление
- **Детальная аналитика** - Расширенная отчетность в админке
- **Мобильная оптимизация** - Улучшение мобильной версии

## 🚨 Известные особенности и ограничения

### Технические особенности:
- **SSL сертификат**: НЕ используется на app.sevkorzina.ru для корректной SMS рассылки
- **Тестовые платежи**: ЮKassa в тестовом режиме
- **CORS настройки**: Настроены для работы с поддоменом
- **Файлы сервера**: Постоянно обновляются в project knowledge

### Архитектурные решения:
- **State Management**: Provider (не Redux/Bloc)
- **API Architecture**: REST (не GraphQL)
- **Database ORM**: Prisma (не TypeORM)
- **Authentication**: JWT токены (не OAuth)

## 📞 Контактная информация и доступы

### Домены и сервисы:
- **Основной домен**: sevkorzina.ru
- **Веб-приложение**: app.sevkorzina.ru (без SSL)
- **Сервер**: Yandex Cloud (sudo доступ)
- **База данных**: PostgreSQL на том же сервере

### Внешние сервисы:
- **ЮKassa**: Тестовый аккаунт настроен
- **SMS сервис**: Настроено

## 🔧 Техническая информация для разработки

### Команды для запуска:
```bash
# Frontend (Flutter)
flutter run

# Backend (Node.js)
npm install
npm start

# Admin Panel (Flutter)
flutter run -d chrome
```

### Переменные окружения:
```env
DATABASE_URL=postgresql://...
JWT_SECRET=...
YOOKASSA_SHOP_ID=...
YOOKASSA_SECRET_KEY=...
```

### Порты и эндпоинты:
- **Backend API**: Стандартный порт (обычно 3000)
- **Flutter Web**: Порт разработки (обычно 8080)
- **Database**: Стандартный PostgreSQL порт (5432)

---

**Примечание**: Этот документ является живым - обновляется при каждом значительном изменении в проекте. Файлы сервера автоматически синхронизируются с project knowledge для актуальной информации о состоянии системы.